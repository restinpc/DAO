(()=>{"use strict";var t={752:function(t,e,n){var o=this&&this.__assign||function(){return o=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},o.apply(this,arguments)};e.__esModule=!0,e.default=void 0;var r=n(343),a=n(410),i=n(179),s=n(877);e.default=function(){var t,e=this;this.load=function(){e.preloaded?setTimeout((function(){e.dataSource.init(e.token).then((function(t){e.setState(o(o({},e.state),{step:t?2:1,loaded:!0}))}))}),1):e.preloaded=!0},this.setState=function(t){e.handler.debug("Before dispatch >> "),e.handler.debug(e.state),e.handler.debug("Will dispatch >>"),e.handler.debug(t),e.state=o(o({},e.state),t),e.handler.debug("After dispatch >> "),e.handler.debug(e.state);var n=function(t){var e=!1;return t.forEach((function(n){n.getNodes().forEach((function(n){t.indexOf(n)<0&&(e=!0,t.push(n))}))})),e?n(t):t};e.DOMObjects.forEach((function(t){JSON.stringify(t.props)!==JSON.stringify(t.updateProps())&&(n(e.stdin.getNodes()).indexOf(t)>=0||t===e.stdin)&&(t.parent&&t.parent.getNodes().indexOf(t)>=0||t===e.stdin)&&t.render(t.parent?t.parent.element:e.stdout)}))},this.render=function(){try{e.handler.log("App.render(".concat(e.renderId,")")),e.renderId++,e.stdin.updateProps(),e.stdin.render(e.stdout)}catch(t){e.handler.error("App.render(".concat(e.renderId,") -> ").concat(t.message))}},this.document={getState:function(){return e.state},setState:function(t){e.setState(t)}};try{this.handler=new s.default(this),this.handler.log("App.constructor()"),this.renderId=0,this.preloaded=!1,this.DOMObjects=[],this.stdout=document.getElementById("header-app"),this.stdout.innerHTML=a.default,this.stdout=this.stdout.getElementsByClassName("root")[0],this.dataSource=new r.default(this),this.dir=this.stdout.parentElement.getAttribute("dir"),this.lang=this.stdout.parentElement.getAttribute("lang"),this.isApp="true"==this.stdout.parentElement.getAttribute("isApp"),this.token=null===(t=document.cookie.split("; ").find((function(t){return t.startsWith("token=")})))||void 0===t?void 0:t.split("=")[1],this.state={step:0,loaded:!1,frameId:0},(0,i.default)(this),this.render(),"complete"===document.readyState?(this.preloaded=!0,this.load()):(setTimeout(this.load,1),window.addEventListener("load",(function(){return setTimeout(e.load,1)})))}catch(t){this.handler.error("App.constructor() -> ".concat(t.message))}}},305:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var a=function(t){function e(e,n,o,r,a,i){void 0===o&&(o=null);var s=t.apply(this,arguments)||this;return s.childNodes={},s.loaded=!1,s}return r(e,t),e.prototype.getNodes=function(){var t=this,e=[];return this.props.views.forEach((function(n){n.condition&&t.nodes.forEach((function(t){t.name===n.name&&e.push(t)}))})),e},e.prototype.parseProps=function(){var e=this;if(t.prototype.parseProps.call(this),this.props.views&&this.props.views.length){var n=[];this.props.views.forEach((function(t){t.condition()&&n.push(t)}));var o=void 0;do{o=!1;for(var r=function(t){var o=!1;if(n.forEach((function(n){e.nodes[t]&&n.name===e.nodes[t].name&&(o=!0)})),!o)return a.removeChild(a.nodes[t]),o=!0,"break"},a=this,i=this.nodes.length-1;i>=0&&"break"!==r(i);i--);}while(o);n.forEach((function(t){e.childNodes&&e.childNodes[t.name]?e.addChild(e.childNodes[t.name]):e.childNodes[t.name]=t.content(e.app,e)}))}},e.prototype.render=function(e){try{this.name&&this.app.handler.log("DOMContainer(<".concat(this.tag,' name="').concat(this.name,'"/>).render(').concat(this.renderId,")")),t.prototype.render.call(this,e)}catch(t){this.app.handler.throw("DOMContainer(<".concat(this.tag,' name="').concat(this.name,'"/>).render(').concat(this.renderId,") -> ").concat(t.message))}},e}(n(538).default);e.default=a},538:function(t,e){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)};e.__esModule=!0;var o=function(){function t(t,e,n,o,r,a){void 0===n&&(n=null),o&&t.handler.log("DOMElement.constructor(<".concat(e,' name="').concat(o,'"/>)')),this.renderId=0,this.name=o||"",this.tag=e,this.element=document.createElement(e),this.element.ref=this,this.app=t,this.parent=n,this.props={},this.defaultProps=a,this.mapStateToProps=r,this.nodes=[],this.app.DOMObjects.push(this),this.updateProps()}return t.prototype.getNodes=function(){return this.nodes},t.prototype.updateProps=function(){return this.defaultProps?this.mapStateToProps&&"function"==typeof this.mapStateToProps?this.props=n(n({},this.defaultProps),this.mapStateToProps(this.app.state)):this.props=this.defaultProps:this.mapStateToProps&&"function"==typeof this.mapStateToProps&&(this.props=n({},this.mapStateToProps(this.app.state))),this.props},t.prototype.renderNodes=function(){var t=this;this.nodes.forEach((function(e,n){t.getNodes().indexOf(e)>=0?(e.updateProps(),e.render(t.element),t.element.childNodes[n]&&t.element.childNodes[n].replaceWith(e.element)):e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))},t.prototype.output=function(t){var e=this,n=!1;t&&(t.childNodes.forEach((function(o,r){o.ref===e&&(n=!0,t.childNodes[r].replaceWith(e.element))})),n||this.element.parentNode||t.appendChild(this.element))},t.prototype.parseProps=function(){var t=this,e=this.element;Object.keys(this.props).forEach((function(n){"innerHTML"===n?e.innerHTML=t.props[n]:"className"===n?e.className=t.props[n]:"onClick"===n?e.onclick=t.props[n]:t.props[n]&&"views"!==n&&e.setAttribute(n,t.props[n])})),this.name&&e.setAttribute("name",this.name)},t.prototype.render=function(t){try{this.name&&this.app.handler.log("DOMElement(<".concat(this.tag,' name="').concat(this.name,'"/>).render(').concat(this.renderId,")")),this.renderId++,this.parseProps(),this.renderNodes(),this.output(t)}catch(t){this.app.handler.error("DOMElement(<".concat(this.tag,' name="').concat(this.name,'"/>).render(').concat(this.renderId,") -> ").concat(t.message))}},t.prototype.addChild=function(t){this.name&&t.name&&this.app.handler.log("DOMElement(".concat(this.name,").addChild(").concat(t.name,")")),this.nodes.push(t),this.getNodes().indexOf(t)>=0&&this.element.appendChild(t.element)},t.prototype.removeChild=function(t){this.name&&this.app.handler.log("DOMElement(".concat(this.name,").removeChild(").concat(t.name,")"));var e=[];this.nodes.forEach((function(n){n!==t&&e.push(n)})),this.nodes=e,this.element.removeChild(t.element)},t}();e.default=o},343:(t,e,n)=>{e.__esModule=!0;var o=function(){function t(t){this.app=t,this.app.handler.log("DataSource.constructor()"),this.url=window.location.origin,this.data={},this.request="",this.errorState=0,this.domain="",this.requeries=3,this.timeout=1e3*parseInt("10"),document.dataSource=this}return t.prototype.submitRequest=function(t,e,n,o,r,a){var i=this;return void 0===r&&(r=!0),void 0===a&&(a=!0),new Promise((function(s){i.app.handler.log("DataSource.submitRequest(".concat(t,", ").concat(e,")"));try{var c=new XMLHttpRequest;t.indexOf("http")<0?c.open(e,i.url+t,!0):c.open(e,t,!0),c.timeout=i.timeout,c.setRequestHeader("Content-Type","application/json; charset=utf-8"),c.send(n);var p=!1;c.onreadystatechange=function(){if(4!==c.readyState)return!1;if(!p)if(p=!0,200!==c.status&&400!==c.status&&402!==c.status){if(i.app.handler.error("DataSource.submitRequest(url="+t+").xhr(status="+c.status+") -> "+c.statusText),r)throw i.app.handler.error(c.responseText),c.responseText;a&&++i.errorState<i.requeries?i.submitRequest(t,e,n,o,r,a).then((function(){return s(null)})):s(!1)}else i.errorState=0,s(c.responseText)}}catch(a){if(r)throw i.app.handler.error("DataSource.submitRequest(url="+t+") -> "+a.message),a.message;++i.errorState<i.requeries?i.submitRequest(t,e,n,o).then((function(){return s(null)})):s(!1)}})).then((function(t){return o(t)}))},t.prototype.init=function(t){var e=this;return new Promise((function(n){e.app.handler.log("DataSource.init()");try{e.submitRequest("/token.php?token="+t,"GET",null,(function(t){n("Ok"==t)}))}catch(t){e.app.handler.error("DataSource.ping() -> "+t.message)}}))},t.prototype.ping=function(){var t=this;return new Promise((function(e){t.app.handler.log("DataSource.ping()");try{t.submitRequest("ping","GET",null,(function(t){var n=JSON.parse(t);n&&n.payLoad?e(n.payLoad):e(!1)}))}catch(e){t.app.handler.error("DataSource.ping() -> "+e.message)}}))},t.prototype.post=function(t){var e=this;return new Promise((function(n){e.app.handler.log("DataSource.post(".concat(t,")"));try{var o={id:t};e.submitRequest("share","POST",JSON.stringify(o),(function(t){var e=JSON.parse(t);e&&e.payLoad?n(e.payLoad):n(!1)}))}catch(t){e.app.handler.error("DataSource.post() -> "+t.message)}}))},t.prototype.submitTraceStack=function(t){var e=this;return new Promise((function(o){e.app.handler.log("DataSource.submitTraceStack()");try{var r=Promise.resolve().then((function(){return n(147)}));e.submitRequest("https://localhost:8443","POST",JSON.stringify({agent:navigator.userAgent,app:"header-app",version:r.version,url:window.location.toString(),text:t}),(function(t){return!!JSON.parse(t)}))}catch(t){e.app.handler.error("DataSource.submitTraceStack() -> "+t.message)}}))},t}();e.default=o},877:(t,e)=>{e.__esModule=!0;var n=function(){function t(t){this.app=t,this.errorState=!1,this.traceStack=[]}return t.prototype.log=function(t){t="".concat("Header",".").concat("string"==typeof t?t:JSON.stringify(t)),this.traceStack.push("".concat((new Date).toLocaleString()," log ").concat(t)),console.log(t)},t.prototype.info=function(t){t="".concat("Header",".").concat("string"==typeof t?t:JSON.stringify(t)),this.traceStack.push("".concat((new Date).toLocaleString()," info ").concat(t)),console.info(t)},t.prototype.warn=function(t){t="".concat("Header",".").concat("string"==typeof t?t:JSON.stringify(t)),this.traceStack.push("".concat((new Date).toLocaleString()," warn ").concat(t)),console.warn(t)},t.prototype.debug=function(t){t="".concat("Header",".").concat("string"==typeof t?t:JSON.stringify(t)),this.traceStack.push("".concat((new Date).toLocaleString()," debug ").concat(t)),console.debug(t)},t.prototype.error=function(t){t="".concat("Header",".").concat("string"==typeof t?t:JSON.stringify(t)),this.traceStack.push("".concat((new Date).toLocaleString()," error ").concat(t)),console.error(t)},t.prototype.throw=function(t){t="".concat("Header",".").concat("string"==typeof t?t:JSON.stringify(t)),this.traceStack.push("".concat((new Date).toLocaleString()," throw ").concat(t)),console.error(t),this.bsod(),this.submit()},t.prototype.bsod=function(){var t=this.app.stdout;t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.right="0px",t.style.bottom="0px",t.style.display="block",t.style.opacity="1",t.innerHTML="Расширение ".concat("Header"," было остановленно из-за непредвиденного исключения"),t.style.backgroundPosition="center center",t.style.backgroundSize="cover"},t.prototype.submit=function(){var t=this;return new Promise((function(e){if(!t.errorState){t.errorState=!0;var n="";if(t.traceStack.length<=200)t.traceStack.forEach((function(t){n+=t.toString().substring(0,1e3)+"<br/>"}));else{for(var o=0;o<100;o++)n+=t.traceStack[o].toString().substring(0,1e3)+"<br/>";for(n+="Пропущено ".concat(t.traceStack.length-200," строк<br/><hr/><br/>"),o=t.traceStack.length-100;o<t.traceStack.length-1;o++)n+=t.traceStack[o].toString().substring(0,1e3)+"<br/>"}t.app.dataSource.submitTraceStack(n).then((function(t){e(t)}))}}))},t}();e.default=n},179:(t,e,n)=>{e.__esModule=!0;var o=n(305),r=n(538),a=n(107),i=n(754);e.default=function(t){try{t.handler.log("App.MainView()"),t.stdin=new r.default(t,"div",null,"",(function(t){return{loaded:t.loaded}})),t.stdin.addChild(new o.default(t,"div",t.stdin,"container",(function(t){return{views:[{name:"Step1View",condition:function(){return 1===t.step},content:a.default},{name:"Step2View",condition:function(){return 2===t.step},content:i.default}],step:t.step}}),{}))}catch(e){t.handler.error("App.MainView() -> ".concat(e.message))}}},107:(t,e,n)=>{e.__esModule=!0;var o=n(538);e.default=function(t,e){try{t.handler.log("App.Step1View()");var n=new o.default(t,"div",e,"Step1View",null,{});e.addChild(n);var r={en:"Sign Up",ru:"Регистрация",zh:"報名"},a={en:"Login",ru:"Логин",zh:"登錄"},i="";return t.isApp&&(i='<li>\n                    <a target="_top" id="b3" onClick=\'window.location = "/#close";\' class="btn btn-round">\n                        <noindex class="material-icons">close</noindex> '.concat({en:"Close application",ru:"Закрыть приложение",zh:"關閉申請"}[t.lang],"\n                    </a>\n                </li>")),n.addChild(new o.default(t,"div",n,"step1",(function(e){return{innerHTML:'<li>\n                        <a target="_parent" id="b1" hreflang="'.concat(t.lang,'" href="').concat(t.dir,'/signup" class="btn btn-round">\n                            <noindex class="material-icons">person_add</noindex> ').concat(r[t.lang],' \n                        </a>\n                    </li>\n                    <li>\n                        <a target="_parent" id="b2" hreflang="').concat(t.lang,'" href="').concat(t.dir,'/login" class="btn btn-round">\n                            <noindex class="material-icons">account_circle</noindex> ').concat(a[t.lang]," \n                        </a>\n                    </li>\n                    ").concat(i)}}))),n}catch(e){t.handler.error("App.Step1View() -> ".concat(e.message))}}},754:(t,e,n)=>{e.__esModule=!0;var o=n(538);e.default=function(t,e){try{t.handler.log("App.Step2View()");var n=new o.default(t,"div",e,"Step2View",null,{});e.addChild(n);var r={en:"Account",ru:"Аккаунт",zh:"帳戶"},a={en:"Logout",ru:"Выход",zh:"登出"},i="";return t.isApp&&(i='<li>\n                    <a target="_top" id="b3" onClick=\'window.location = "/#close";\' class="btn btn-round">\n                        <noindex class="material-icons">close</noindex> '.concat({en:"Close application",ru:"Закрыть приложение",zh:"關閉申請"}[t.lang],"\n                    </a>\n                </li>")),n.addChild(new o.default(t,"div",n,"step2",(function(e){return{innerHTML:'\n                    <li>\n                        <a hreflang="'.concat(t.lang,'" href="').concat(t.dir,'/account" onclick="hide_menu();" id="b1" class="btn btn-round">\n                            <noindex class="material-icons">person</noindex> ').concat(r[t.lang],'\n                        </a>\n                    </li>\n                    <li>\n                        <a target="_parent" id="b2" onclick="hide_menu(); logout();" class="btn btn-round">\n                            <noindex class="material-icons">directions_run</noindex> ').concat(a[t.lang],"\n                        </a>\n                    </li>\n                    ").concat(i)}}))),n}catch(e){t.handler.error("App.Step2View() -> ".concat(e.message))}}},410:(t,e)=>{e.__esModule=!0,e.default='<div class="root" />'},147:t=>{t.exports=JSON.parse('{"name":"header-application","version":"1.0.1","devDependencies":{"@types/node":"^17.0.45","@types/webpack-dev-server":"^4.7.2","dotenv-webpack":"^7.1.0","ts-loader":"^9.2.8","typescript":"^4.9.5","webpack":"^5.72.0","webpack-cli":"^4.10.0"},"scripts":{"start":"webpack --watch --mode development","build":"webpack --mode production","deploy":"cp ./public/dist/bundle.js ../public_html/apps/header"}}')}},e={};new(function n(o){var r=e[o];if(void 0!==r)return r.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}(752).default)})();